{"EventId":964,"EventType":"Custom","EventName":"Control Entrance Gate","EventDescription":" Enter EventDescription","Deletable":1,"DomainId":-1,"UpdateDate":"2024-03-05T15:58:38.000Z","UpdatedBy":"Ahmed_allawy","isReadOnly":0,"CreationDate":"2024-03-05T15:18:58.000Z","CreatedBy":"Ahmed_allawy","Deleted":0,"DeletionDate":null,"DeletedBy":null,"Lock":{"Username":"Ahmed_allawy"},"EventParameters":[{"ParameterId":36343,"EventId":964,"ParameterName":"Code","ParameterValue":"var carId=Sensor.reading.reading1;\n\nconst query=\"SELECT * FROM APPLICATION_4748 WHERE CarID = \"+carId+\" LIMIT 1\";\n\nfunction searchIn_callback (err, result) {\n  if (err) {\n    return event.error(err);\n  }\n\n  // write your code here\n  const opt= {\n    \"mqttUrl\": \"learning.masterofthings.com\",\n      \"port\": \"1883\",\n      \"topic\": \"Phone/01013299050/allawy/Gate1\",\n      \"username\": \"MoTSensorKitv2.0\",\n      \"password\": \"MoTSensorKitv2.0Pass\",\n      \"message\": \"open\" // message must be string\n  }\n\n  ;\n\n  function mqttPublish_callback (err) {\n    if (err) {\n      return event.error(err);\n    }\n\n    // write your code here\n    event.log('message published successfully');\n    event.end();\n  }\n\n  if(result.length>0) {\n    opt[\"message\"] = \"open message from callback function code\";\n    MqttPublish(opt, mqttPublish_callback);\n  }\n\n  else {\n    opt[\"message\"] = \"buzzer message from callback function code\";\n    MqttPublish(opt, mqttPublish_callback);\n  }\n\n  // event.log(JSON.stringify(result));\n  // event.end();\n}\n\nSearchIn(query, searchIn_callback);"},{"ParameterId":36344,"EventId":964,"ParameterName":"RunAs","ParameterValue":"[[RunAs]]"}],"Groups":[11380],"IsSaved":true}