{"EventId":966,"EventType":"Custom","EventName":"Control Entrance Gate Promises","EventDescription":" Enter EventDescription","Deletable":1,"DomainId":-1,"UpdateDate":"2024-03-05T15:58:36.000Z","UpdatedBy":"Ahmed_allawy","isReadOnly":0,"CreationDate":"2024-03-05T15:38:38.000Z","CreatedBy":"Ahmed_allawy","Deleted":0,"DeletionDate":null,"DeletedBy":null,"Lock":{"Username":"Ahmed_allawy"},"EventParameters":[{"ParameterId":36341,"EventId":966,"ParameterName":"Code","ParameterValue":"var carId=Sensor.reading.reading1;\n\nconst query=\"SELECT * FROM APPLICATION_4748 WHERE CarID = \"+carId+\" LIMIT 1\";\n\nconst opt= {\n  \"mqttUrl\": \"learning.masterofthings.com\",\n    \"port\": \"1883\",\n    \"topic\": \"Phone/01013299050/allawy/Gate1\",\n    \"username\": \"MoTSensorKitv2.0\",\n    \"password\": \"MoTSensorKitv2.0Pass\",\n    \"message\": \"open\" // message must be string\n}\n\n;\n\nSearchInAsync(query) \n  \n  .then(function(result) {\n\n    if(result.length>0) {\n      opt.message=\"open message from promises code\";\n      return MqttPublishAsync(opt);\n    }\n\n    else {\n      opt.message=\"buzzer message from promises code\";\n      return MqttPublishAsync(opt);\n    }\n  }).then(function() {\n      event.log('message published successfully');\n      event.end();\n    }\n\n  )\n  .catch(function(err) {\n    event.log(err);\n    event.end();\n  }\n\n);"},{"ParameterId":36342,"EventId":966,"ParameterName":"RunAs","ParameterValue":"[[RunAs]]"}],"Groups":[11380],"IsSaved":true}